

### TCP UDP
TCP/IP协议（一）网络基础知识 网络七层协议   
https://www.cnblogs.com/wanghuaijun/p/10092930.html   
- TCP(Transmission Control Protocol 传输控制协议)：是一种面向连接的、可靠的、基于字节流的传输层通信协议，使用三次握手协议建立连接、四次挥手断开连接。面向连接意味着两个使用TCP的应用(通常是一个客户端和一个服务器)在彼此交换数据包之前必须先建立一个TCP连接。在一个TCP连接中，仅有两方进行彼此通信，广播和多播不能用TCP。TCP 协议的作用是，保证数据通信的完整性和可靠性，防止丢包。TCP把连接作为最基本的对象，每一条TCP连接都有两个端点，这种端点我们叫作套接字(socket)，端口号拼接到IP地址即构成了套接字。
- UDP(User Datagram Protocol 用户数据报协议)：是OSI(Open System Interconnection 开放式系统互联)参考模型中一种无连接的传输层协议，提供面向事务的简单不可靠信息传送服务。UDP协议的主要作用是将网络数据流量压缩成数据包的形式。
- 区别：
    - TCP提供的是面向连接的、可靠的数据流传输；UDP提供的是非面向连接的、不可靠的数据流传输。
    - TCP提供可靠的服务，通过TCP连接传送的数据，无差错、不丢失、不重复，按序到达；UDP尽最大努力交付，即不保证可靠交付。
    - TCP面向字节流；UDP面向报文。
    - TCP连接只能是点到点的；UDP支持一对一、一对多、多对一和多对多的交互通信。
    - UDP具有较好的实时性，工作效率比TCP高，适用于对高速传输和实时性有较高的通信或广播通信。
    - TCP对系统资源要求较多，UDP对系统资源要求较少。TCP首部有20字节；UDP的首部只有8个字节。
    - TCP的逻辑通信信道是全双工的可靠信道；UDP的逻辑通信信道是不可靠信道。 
    - 基于TCP的应用：HTTP、WebSocket、重要数据文件传输等常见
    - 基于UDP的应用：QQ等部分实时通信软件、视频/音频下载传输等。  

### TCP 粘包/半包的原因与处理
- 原因：TCP 面向字节流，不保消息边界；Nagle、延迟 ACK、接收端缓冲区大小都会导致一次收包含多条或半条消息。
- 处理：为消息定义长度头（固定长度或 varint），或使用分隔符协议并转义特殊符号；接收端循环读取缓冲区并解析完整帧后再处理。
- Unity/Netty 常用方案：前 4 字节标明消息长度，小端存储；读循环中不足长度则等待下一轮填满。

### WebSocket 心跳与断线重连策略
- 心跳：客户端定期发送 `ping` 或自定义心跳，服务器返回 `pong`；超时阈值通常为 2~3 个心跳周期。
- 重连：指数退避（如 1s/2s/4s/8s）+ 最大重试次数，重连前先关闭旧连接；重连成功后进行**状态同步/房间重入**。
- 前台/后台切换：移动端应用进入后台可暂停心跳并在恢复时立即补发心跳或全量同步。

### UDP 可靠性的常见增强手段
- 序号 + ACK/NACK：每个报文带序号，接收端回 ACK；缺失序号通过 NACK 或重传窗口请求补发。
- 滑动窗口 + 超时重传：控制在飞数据包数量，超时未确认即重传；丢包环境下需动态调整窗口。
- 常见实践：KCP/ENet 在 UDP 上实现可靠、有序或部分有序传输，用于实时游戏同步。


### 三次握手，4次挥手
- 三次握手
    - 第一次握手：客户端发送网络包，服务端收到了。这样服务端就能得出结论：客户端的发送能力、服务端的接收能力是正常的。：客户端给服务端发一个 SYN 报文，并指明客户端的初始化序列号 ISN(c)。此时客户端处于 SYN_Send状态。
    - 第二次握手：服务器收到客户端的 SYN 报文后，发送 SYN+ACK，指定自己的 ISN(s)，并把客户端的 ISN+1 作为 ACK 值；此时服务器处于 SYN_RCVD 状态。
    - 第三次握手：客户端收到 SYN+ACK 后发送 ACK（ACK=ISN(s)+1），客户端进入 ESTABLISHED 状态。
    - 服务器收到 ACK 报文后也进入 ESTABLISHED 状态，连接建立。
- 四次挥手
    - 第一次挥手：客户端发送 FIN，请求关闭，进入 FIN_WAIT_1。
    - 第二次挥手：服务器回 ACK（确认号=FIN 序号+1），进入 CLOSE_WAIT；客户端收到后进入 FIN_WAIT_2。
    - 第三次挥手：服务器完成收尾后发送 FIN，进入 LAST_ACK。
    - 第四次挥手：客户端回 ACK（确认号=FIN 序号+1），进入 TIME_WAIT，等待 2MSL 后进入 CLOSED；服务器收到 ACK 后进入 CLOSED。


### 状态同步,帧同步

帧同步和状态同步该怎么选（上）  
https://zhuanlan.zhihu.com/p/104932624  

帧同步和状态同步  
https://zhuanlan.zhihu.com/p/33898014  

王者荣耀游戏中帧同步如何分离逻辑和渲染？ - k8w的回答 - 知乎
https://www.zhihu.com/question/323505671/answer/2271083741


